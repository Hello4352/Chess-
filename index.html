<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<title>사람 vs AI 체스</title>
<style>
  body { font-family: Arial; background: #f0f0f0; display: flex; flex-direction: column; align-items: center; margin:0; padding:20px; }
  #board { width: 480px; }
  #status { margin-top:10px; font-weight:bold; }
</style>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/chessboard.js/1.0.0/css/chessboard.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/chessboard.js/1.0.0/js/chessboard.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/chess.js/0.10.3/chess.min.js"></script>
</head>
<body>
<h1>사람 vs AI 체스</h1>
<div id="board"></div>
<div id="status"></div>
<script>
const game = new Chess();
const board = Chessboard('board', {
  draggable: true,
  position: 'start',
  pieceTheme: 'https://chessboardjs.com/img/chesspieces/wikipedia/{piece}.png',
  onDrop: handleMove
});
const stockfish = new Worker('stockfish.js');

stockfish.onmessage = function(event) {
  const line = event.data;
  if (line.startsWith('bestmove')) {
    const move = line.split(' ')[1];
    game.move({ from: move.substr(0,2), to: move.substr(2,2), promotion: 'q' });
    board.position(game.fen());
    updateStatus();
  }
};

function handleMove(source, target) {
  const move = game.move({ from: source, to: target, promotion: 'q' });
  if (move === null) return 'snapback';
  board.position(game.fen());
  updateStatus();
  stockfish.postMessage('position fen ' + game.fen());
  stockfish.postMessage('go depth 15');
}

function updateStatus() {
  let status = '';
  if (game.in_checkmate()) status = '체크메이트! 게임 종료';
  else if (game.in_draw()) status = '무승부';
  else {
    status = (game.turn()==='w'?'백':'흑')+' 차례';
    if (game.in_check()) status += ' - 체크!';
  }
  document.getElementById('status').innerText = status;
}

updateStatus();
</script>
</body>
</html>
